<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Armazenamento Seguro de Dados</title>
    <style>
        #dadoExibido {
            display: none;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            max-height: 200px; /* Altura máxima da área de exibição */
            overflow-y: auto; /* Adiciona barra de rolagem vertical se o conteúdo ultrapassar a altura máxima */
        }
    </style>
</head>
<body>
    <h1>Armazenamento Seguro de Dados</h1>
    
    <label for="dado">Dado:</label>
    <input type="text" id="dado">
    
    <label for="senhaEnviar">Senha:</label>
    <input type="password" id="senhaEnviar">
    
    <button onclick="enviarDado()">Enviar Dado e Senha</button>
    
    <hr>
    
    <label for="senhaVerificar">Senha:</label>
    <input type="password" id="senhaVerificar">
    
    <button onclick="verificarDado()">Verificar Dado</button>

    <div id="dadoExibido"></div> <!-- Área para exibir o dado verificado -->

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <script>
        const contratoAddress = '0x448f2A3888e58b3A36079213294A71b73A4e138E';
        const contratoABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "usuario",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "dado",
				"type": "string"
			}
		],
		"name": "DadoEnviado",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "dado",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "senha",
				"type": "string"
			}
		],
		"name": "enviarDado",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "sacarTaxa",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalTaxa",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "senha",
				"type": "string"
			}
		],
		"name": "verificarDado",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

        const web3 = new Web3(Web3.givenProvider);
        let contrato;

        async function enviarDado() {
            const dado = document.getElementById("dado").value;
            const senha = document.getElementById("senhaEnviar").value;
            const contas = await web3.eth.getAccounts();
            await contrato.methods.enviarDado(dado, senha).send({ from: contas[0], value: web3.utils.toWei('0.01', 'ether') });
            alert("Dado e senha enviados com sucesso!");
        }

        async function verificarDado() {
            const senha = document.getElementById("senhaVerificar").value;
            const dadoVerificado = await contrato.methods.verificarDado(senha).call();
            if (dadoVerificado === '') {
                alert("Senha incorreta ou dado não encontrado.");
            } else {
                exibirDadoVerificado(dadoVerificado);
            }
        }

        // Função para exibir o dado verificado na área correspondente
        function exibirDadoVerificado(dado) {
            const dadoExibido = document.getElementById("dadoExibido");
            dadoExibido.textContent = "Dado verificado: " + dado;
            dadoExibido.style.display = "block"; // Exibe a área de exibição do dado
        }

        window.addEventListener('load', async () => {
            contrato = new web3.eth.Contract(contratoABI, contratoAddress);
        });
    </script>
</body>
</html>
